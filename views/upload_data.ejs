<!DOCTYPE html>
<html lang="en">

<head>
    <% include partials/page/head.ejs %>
</head>
<link href="../../file-input/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css"/>

<% include partials/page/jsdefaults.ejs %>
<body class="home">
<!-- Navigation (main menu)
================================================== -->
<% include partials/page/navbar.ejs %>

<!-- Cover element
================================================== -->
<div ng-app="uploadModule" ng-controller="uploadCtrl">

    <div class="cover-container overlay" style="padding-top: 20%; padding-bottom: 20%;">
        <div class=" cover-inner">
            <div class="container">
                <h1 style="color:#fff;">Upload</h1>

                <form>

                    <div class="form-group">
                        <label for="exampleInputFile">Avatar</label>
                        <input type="file" id="exampleInputFile" file-model="excel.file">
                    </div>
                    <button type="submit" class="btn btn-default" ng-click="Submit()">Submit</button>
                </form>
                {{status}}
            </div>
            <!-- /.container -->
        </div>
        <!-- /.cover-inner -->
    </div>
    <!-- /.cover-container -->
</div>
<!-- /.cover-wrapper -->


</body>

<footer id="footer">
    <% include partials/page/footer.ejs %>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="../../file-input/js/fileinput.min.js"></script>

<script>
    var myApp = angular.module('uploadModule', []);
    myApp.controller('uploadCtrl', ['$scope', 'multipartForm', function($scope, multipartForm){
        $scope.status = "No Activity";
        $scope.Submit = function(){
            var uploadUrl = '/upload';
            $scope.status = "Processing";
            multipartForm.post(uploadUrl, $scope.excel, $scope);
        }
    }]);

    myApp.service('multipartForm', ['$http', function($http){
        this.post = function(uploadUrl, data, scope){
            var fd = new FormData();
            for(var key in data)
                fd.append(key, data[key]);
            $http.post(uploadUrl, fd, {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).success(function(response) {
                scope.status = response.message;
            });
        }
    }]);

    myApp.directive('fileModel', ['$parse', function ($parse) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                var model = $parse(attrs.fileModel);
                var modelSetter = model.assign;

                element.bind('change', function(){
                    scope.$apply(function(){
                        modelSetter(scope, element[0].files[0]);
                    });
                });
            }
        };
    }]);

</script>
</html>